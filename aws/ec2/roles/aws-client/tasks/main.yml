---

- name: Create ~/.aws/
  file:
    path: /home/ubuntu/.aws
    state: directory
    mode: 0700

- name: Upload AWS config and credentials
  copy:
    src: "{{ lookup('env','HOME') }}/.aws/{{ item }}"
    dest: "/home/ubuntu/.aws/{{ item }}"
    mode: 0400
  with_items:
    - config
    - credentials

- name: Setup .bashrc
  lineinfile:
    path: /home/ubuntu/.bashrc
    regexp: "export\\s{{ item.key }}="
    line: "export {{ item.key }}=\"{{ item.val }}\""
  with_items:
    - key: AWS_ACCESS_KEY_ID
      val: "{{ aws_access_key_id }}"
    - key: AWS_SECRET_ACCESS_KEY
      val: "{{ aws_secret_access_key }}"
